{% extends "base_admin.html" %}
{% load static %}

{% block wrapper %}
<div class="wrapper">
    {% include "admin_partial/left_sidebar.html" %}

    <div class="content-page">
        <div class="content">
            {% include "admin_partial/topbar.html" %}
            <div class="container-fluid">

                <div class="row">
                    <div class="col-12">
                        <div class="page-title-box">
                            <div class="page-title-right">
                                <ol class="breadcrumb m-0">
                                    <li class="breadcrumb-item"><a href="javascript: void(0);">SomaliRealEState</a></li>
                                    <li class="breadcrumb-item"><a href="javascript: void(0);">Pages</a></li>
                                    <li class="breadcrumb-item active">Dashboard</li>
                                </ol>
                            </div>
                            <h4 class="page-title">Dashboard</h4>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-3">
                        <div class="card widget-flat">
                            <div class="card-body">
                                <div class="float-end">
                                    <i class="uil-users-alt widget-icon"></i>
                                </div>
                                <h5 class="text-muted fw-normal mt-0" title="Average Revenue">Registered Tenants</h5>
                                <h3 class="mt-3 mb-3">{{ tenants }}</h3>
                                <p class="mb-0 text-muted">
                                    <span class="text-danger me-2"><i class="mdi mdi-arrow-down-bold"></i> 7.00%</span>
                                    <span class="text-nowrap">Since last month</span>
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3">
                        <div class="card widget-flat">
                            <div class="card-body">
                                <div class="float-end">
                                    <i class="uil-user widget-icon"></i>
                                </div>
                                <h5 class="text-muted fw-normal mt-0" title="Growth">Registered Owners</h5>
                                <h3 class="mt-3 mb-3">{{ owners }}</h3>
                                <p class="mb-0 text-muted">
                                    <span class="text-success me-2"><i class="mdi mdi-arrow-up-bold"></i> 4.87%</span>
                                    <span class="text-nowrap">Since last month</span>
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3">
                        <div class="card widget-flat">
                            <div class="card-body">
                                <div class="float-end">
                                    <i class="dripicons-home widget-icon"></i>
                                </div>
                                <h5 class="text-muted fw-normal mt-0" title="Average Revenue">All Apartments Available</h5>
                                <h3 class="mt-3 mb-3">{{ apartment_count }}</h3>
                                <p class="mb-0 text-muted">
                                    <span class="text-danger me-2"><i class="mdi mdi-arrow-down-bold"></i> 7.00%</span>
                                    <span class="text-nowrap">Since last month</span>
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3">
                        <div class="card widget-flat">
                            <div class="card-body">
                                <div class="float-end">
                                    <i class="mdi mdi-pulse widget-icon"></i>
                                </div>
                                <h5 class="text-muted fw-normal mt-0" title="Growth">All Apartment Units</h5>
                                <h3 class="mt-3 mb-3">{{ rooms }}</h3>
                                <p class="mb-0 text-muted">
                                    <span class="text-success me-2"><i class="mdi mdi-arrow-up-bold"></i> 4.87%</span>
                                    <span class="text-nowrap">Since last month</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-3">
                        <div class="card widget-flat">
                            <div class="card-body">
                                <div class="float-end">
                                   
                                    <i class="uil-store widget-icon"></i>
                                </div>
                                <h5 class="text-muted fw-normal mt-0" title="Average Revenue">All Available Houses</h5>
                                <h3 class="mt-3 mb-3">{{ house }}</h3>
                                <p class="mb-0 text-muted">
                                    <span class="text-danger me-2"><i class="mdi mdi-arrow-down-bold"></i> 7.00%</span>
                                    <span class="text-nowrap">Since last month</span>
                                </p>
                            </div>
                        </div>
                    </div>
                    {% comment %} complaint_unresolved {% endcomment %}
                    <div class="col-lg-3">
                        <div class="card widget-flat">
                            <div class="card-body">
                                <div class="float-end">
                                    <i class="uil-comments widget-icon"></i>
                                </div>
                                <h5 class="text-muted fw-normal mt-0" title="Growth">Unresolved Complaints</h5>
                                <h3 class="mt-3 mb-3">{{ complaint_unresolved }}</h3>
                                <p class="mb-0 text-muted">
                                    <span class="text-success me-2"><i class="mdi mdi-arrow-up-bold"></i> 4.87%</span>
                                    <span class="text-nowrap">Since last month</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title">Monthly New Tenants</h4>
                                <canvas id="tenantsChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title">Monthly New Owners</h4>
                                <canvas id="ownersChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title">Monthly Payments</h4>
                                <canvas id="paymentsChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title">Complaints Status</h4>
                                <canvas id="complaintsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        {% include "admin_partial/footer.html" %}
    </div>
</div>
{% endblock %}

{% block right_sidebar %}
{% include "admin_partial/right_sidebar.html" %}
{% endblock %}

{% block footer %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        var ctxTenants = document.getElementById('tenantsChart').getContext('2d');
        var tenantsChart = new Chart(ctxTenants, {
            type: 'line',
            data: {
                labels: {{ labels|safe }},
                datasets: [{
                    label: 'New Tenants',
                    data: {{ tenant_data|safe }},
                    fill: false,
                    borderColor: 'rgba(33, 42, 85, 1)',
                    tension: 0.4,
                    pointBackgroundColor: 'rgba(33, 42, 85, 1)',
                    pointBorderColor: 'rgba(33, 42, 85, 1)',
                    pointHoverBackgroundColor: 'rgba(33, 42, 85, 1)',
                    pointHoverBorderColor: 'rgba(33, 42, 85, 1)'
                }]
            },
            options: {
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    
        var ctxOwners = document.getElementById('ownersChart').getContext('2d');
        var ownersChart = new Chart(ctxOwners, {
            type: 'line',
            data: {
                labels: {{ labels|safe }},
                datasets: [{
                    label: 'New Owners',
                    data: {{ owner_data|safe }},
                    fill: false,
                    borderColor: 'rgba(26, 149, 54, 1)',
                    tension: 0.4,
                    pointBackgroundColor: 'rgba(26, 149, 54, 1)',
                    pointBorderColor: 'rgba(26, 149, 54, 1)',
                    pointHoverBackgroundColor: 'rgba(26, 149, 54, 1)',
                    pointHoverBorderColor: 'rgba(26, 149, 54, 1)'
                }]
            },
            options: {
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    
        var ctxPayments = document.getElementById('paymentsChart').getContext('2d');
        var paymentsChart = new Chart(ctxPayments, {
            type: 'bar',
            data: {
                labels: {{ labels|safe }},
                datasets: [{
                    label: 'Total Payments',
                    data: {{ payment_data|safe }},
                    backgroundColor: 'rgba(87, 130, 193, 1)',
                    borderColor: 'rgba(87, 130, 193, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    
        var ctxComplaints = document.getElementById('complaintsChart').getContext('2d');
        var complaintsChart = new Chart(ctxComplaints, {
            type: 'doughnut',
            data: {
                labels: ['Unresolved', 'In Progress', 'Resolved'],
                datasets: [{
                    label: 'Complaints Status',
                    data: {{ complaints_data|safe }},
                    backgroundColor: [
                        'rgba(33, 42, 85, 1)',
                        'rgba(26, 149, 54, 1)',
                        'rgba(87, 130, 193, 1)'
                    ],
                    borderColor: [
                        'rgba(33, 42, 85, 1)',
                        'rgba(26, 149, 54, 1)',
                        'rgba(87, 130, 193, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: 'Complaints Status'
                    }
                }
            }
        });
    });
</script>
{% endblock %}
